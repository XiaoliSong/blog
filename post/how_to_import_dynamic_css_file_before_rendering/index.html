
    <html>
        <head>
        <title>如何在页面渲染前加入动态的CSS的文件</title>
        <meta name="keywords" content="如何在页面渲染前加入动态的CSS的文件,Xl的博客">
        <meta name="description" content="如何在页面渲染前加入动态的CSS的文件,Xl的博客">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
        
    <link rel="stylesheet" type="text/css" href="https://blog-1252791686.cos.ap-beijing.myqcloud.com/css/global.css">
    
    <link rel="stylesheet" type="text/css" href="https://blog-1252791686.cos.ap-beijing.myqcloud.com/css/md.css">
    
    <link rel="stylesheet" type="text/css" href="https://blog-1252791686.cos.ap-beijing.myqcloud.com/css/article.css">
    
        
        </head>
    <body>
     
    <div id="header">
        <button id='switch_btn'></button>
        <a href="/about.html" title="关于">
            <img src="https://blog-1252791686.cos.ap-beijing.myqcloud.com/icon/logo.png"/>
        </a>
        <h1>Xl的博客</h1>
    </div>
     
    <nav id="sidebar">
        <div id="profile">
            
    <a href="/" title="Xl的博客">
        <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/logo.png" alt="Xl的博客"/>
    </a>
    <span>Xl的博客</sapn>
    
        </div>

        <ul id="row_links">
            
    <li>
        <a href="/index.html" title="首页">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/home.png"/>
            <span>首页</span>
        </a>
    </li>
    
    <li>
        <a href="/archive.html" title="归档">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/archives.png"/>
            <span>归档</span>
        </a>
    </li>
    
    <li>
        <a href="/tag.html" title="标签">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/tags.png"/>
            <span>标签</span>
        </a>
    </li>
    
    <li>
        <a href="/works.html" title="作品">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/works.png"/>
            <span>作品</span>
        </a>
    </li>
    
    <li>
        <a href="/recommend.html" title="推荐">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/recommend.png"/>
            <span>推荐</span>
        </a>
    </li>
    
    <li>
        <a href="/about.html" title="关于">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/about.png"/>
            <span>关于</span>
        </a>
    </li>
    
    <li>
        <a href="/friends.html" title="友链">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/friends.png"/>
            <span>友链</span>
        </a>
    </li>
    
        </ul>

        <ul id="col_links">
            
    <li>
        <a href="https://github.com/XiaoliSong/" title="GitHub">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/github.png"/>
        </a>
    </li>
    
    <li>
        <a href="/search.html" title="Search">
            <img src="https://blog-1252791686.cosbj.myqcloud.com/icon/search.png"/>
        </a>
    </li>
    
        </ul>
    </nav>
     
    <div id="main">
		<div id="content" class="md">
			
    <article class='post'>
        <div class='post_meta'>
            <div class='post_meta_date'>2018-08-12</div>
            <div class='post_commet_cnt'><a href="#SOHUCS"><span id="sourceId::how_to_import_dynamic_css_file_before_rendering" class="cy_cmt_count"></span><span> 评论</span></a></div>
        </div>
        <h1><a>如何在页面渲染前加入动态的CSS的文件</a></h1>
        <div class="toc">
<ul>
<li><a href="#css">页面渲染前加入动态的CSS的文件？</a></li>
<li><a href="#_1">排除的方案</a></li>
<li><a href="#_2">解决方案</a></li>
</ul>
</div>
<h2 id="css">页面渲染前加入动态的CSS的文件？</h2>
<p>这是我自己的说法，可能不大对。主要描述的是这样的场景：</p>
<ul>
<li>css文件url的前缀可能经常变化（比如换对象存储的提供商、需要做迁移）</li>
<li>我们希望在渲染前完成css样式文件的加载</li>
</ul>
<p>所以我的方案场景代码是这样的：</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remoteCss&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="na">tempHref</span><span class="o">=</span><span class="s">&quot;/css/global.css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>希望，能够在页面渲染前完成样式文件的引入。css文件url前缀可能为http://baidu.com或者其他。目前我没有搜索到相关的解决方案。</p>
<h2 id="_1">排除的方案</h2>
<p>有人可能会说，可以直接这样就行了。</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remote_css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="na">temp_href</span><span class="o">=</span><span class="s">&quot;/css/global.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="kr">const</span> <span class="nx">URL_PREFIX</span><span class="o">=</span><span class="s2">&quot;http://www.baidu.com&quot;</span>
        <span class="nx">css_arr</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;remote_css&#39;</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">css_arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">css_arr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">href</span><span class="o">=</span><span class="nx">URL_PREFIX</span><span class="o">+</span><span class="nx">css_arr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;temp_href&quot;</span><span class="p">);</span>
            <span class="cm">/*</span>
<span class="cm">            或者往head动态加入节点，都是不可行的</span>
<span class="cm">            &lt;link class=&quot;remote_css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://www.baidu.com/css/global.css&quot;&gt;</span>
<span class="cm">            */</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>上面是可以动态加入CSS页面文件，但是不是在页面渲染前加载完成的。也就是会导致刚打开页面时，没有css样式就渲染了，等到样式文件加载完成重新渲染。</p>
<h2 id="_2">解决方案</h2>
<p>首先，需要把js脚本放在head里面，保证渲染页面前先执行脚本。然后我们需要利用到css的import特性。</p>
<div class="codehilite"><pre><span></span><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;remote_css&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span> <span class="n">temp_href</span><span class="o">=</span><span class="s2">&quot;/css/global.css&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
        <span class="p">(</span><span class="n">function</span><span class="p">(){</span>
            <span class="n">const</span> <span class="n">URL_PREFIX</span><span class="o">=</span><span class="s2">&quot;http://www.baidu.com&quot;</span><span class="p">;</span>
            <span class="n">let</span> <span class="n">css_arr</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByClassName</span><span class="p">(</span><span class="s2">&quot;remote_css&quot;</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">css_arr</span><span class="o">.</span><span class="n">length</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

            <span class="n">let</span> <span class="n">new_style</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">);</span>
            <span class="n">new_style</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="s2">&quot;text/css&quot;</span><span class="p">);</span>
            <span class="n">let</span> <span class="n">new_css</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="n">let</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">css_arr</span><span class="o">.</span><span class="n">length</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
                <span class="n">new_css</span><span class="o">=</span><span class="n">new_css</span><span class="o">+</span><span class="s2">&quot;@import url(&#39;&quot;</span><span class="o">+</span><span class="n">URL_PREFIX</span><span class="o">+</span><span class="n">css_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">&quot;temp_href&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;);</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">new_style</span><span class="o">.</span><span class="n">styleSheet</span><span class="p">){</span>
                <span class="n">new_style</span><span class="o">.</span><span class="n">styleSheet</span><span class="o">.</span><span class="n">cssText</span><span class="o">=</span><span class="n">newCss</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span><span class="p">{</span>
                <span class="n">new_style</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">new_css</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">new_style</span><span class="p">);</span>
        <span class="p">})();</span>
    <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
    </article>
    
    <div class="post_end">
		--END--
		<div class="post_tags">
			标签：
			
        <a href="/tag.html?tag=前端">#前端</a>
        
		</div>
	</div>
    
    <div id="SOHUCS" sid="how_to_import_dynamic_css_file_before_rendering" ></div>
    <script id="cy_cmt_num" src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cytyIIWkH"></script>
    
		</div>
     
            <footer>
                Xl的博客 - <a href='http://li1996.cn' title='Xl的博客'>li1996.cn </a>
            </footer>
        </div>
        
        
    <script src="https://blog-1252791686.cos.ap-beijing.myqcloud.com/js/global.js"></script>
    
    <script src="https://blog-1252791686.cos.ap-beijing.myqcloud.com/js/sohucs.js"></script>
    
    </body>
    </html>
    