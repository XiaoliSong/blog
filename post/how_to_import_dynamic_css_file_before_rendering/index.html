<html>
 <head>
  <title>
   如何在页面渲染前加入动态的CSS的文件
  </title>
  <meta content="如何在页面渲染前加入动态的CSS的文件,Xl的博客" name="keywords"/>
  <meta content="Xl的博客" name="description"/>
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" name="viewport"/>
  <link href="https://blog-1252791686.cos.ap-beijing.myqcloud.com/css/global.css" rel="stylesheet" type="text/css"/>
  <link href="https://blog-1252791686.cos.ap-beijing.myqcloud.com/css/md.css" rel="stylesheet" type="text/css"/>
  <link href="https://blog-1252791686.cos.ap-beijing.myqcloud.com/css/article.css" rel="stylesheet" type="text/css"/>
 </head>
 <body>
  <div id="header">
   <button id="switch_btn">
   </button>
   <a href="/about.html" title="关于">
    <img alt="关于" src="https://blog-1252791686.cos.ap-beijing.myqcloud.com/icon/logo.png"/>
   </a>
   <h1>
    Xl的博客
   </h1>
  </div>
  <nav id="sidebar">
   <div id="profile">
    <a href="/" title="Xl的博客">
     <img alt="Xl的博客" src="https://blog-1252791686.cosbj.myqcloud.com/icon/logo.png"/>
    </a>
    <span>
     Xl的博客
    </span>
   </div>
   <ul id="row_links">
    <li>
     <a href="/index.html">
      <img alt="首页" src="https://blog-1252791686.cosbj.myqcloud.com/icon/home.png"/>
      <span>
       首页
      </span>
     </a>
    </li>
    <li>
     <a href="/archive.html">
      <img alt="归档" src="https://blog-1252791686.cosbj.myqcloud.com/icon/archives.png"/>
      <span>
       归档
      </span>
     </a>
    </li>
    <li>
     <a href="/tag.html">
      <img alt="标签" src="https://blog-1252791686.cosbj.myqcloud.com/icon/tags.png"/>
      <span>
       标签
      </span>
     </a>
    </li>
    <li>
     <a href="/works.html">
      <img alt="作品" src="https://blog-1252791686.cosbj.myqcloud.com/icon/works.png"/>
      <span>
       作品
      </span>
     </a>
    </li>
    <li>
     <a href="/recommend.html">
      <img alt="推荐" src="https://blog-1252791686.cosbj.myqcloud.com/icon/recommend.png"/>
      <span>
       推荐
      </span>
     </a>
    </li>
    <li>
     <a href="/about.html">
      <img alt="关于" src="https://blog-1252791686.cosbj.myqcloud.com/icon/about.png"/>
      <span>
       关于
      </span>
     </a>
    </li>
    <li>
     <a href="/friends.html">
      <img alt="友链" src="https://blog-1252791686.cosbj.myqcloud.com/icon/friends.png"/>
      <span>
       友链
      </span>
     </a>
    </li>
   </ul>
   <ul id="col_links">
    <li>
     <a href="https://github.com/XiaoliSong/">
      <img alt="GitHub" src="https://blog-1252791686.cosbj.myqcloud.com/icon/github.png"/>
     </a>
    </li>
    <li>
     <a href="/search.html">
      <img alt="Search" src="https://blog-1252791686.cosbj.myqcloud.com/icon/search.png"/>
     </a>
    </li>
    <li>
     <a href="/rss.xml">
      <img alt="RSS" src="https://blog-1252791686.cosbj.myqcloud.com/icon/rss.png"/>
     </a>
    </li>
   </ul>
  </nav>
  <div id="main">
   <div class="md" id="content">
    <article class="post">
     <div class="post_meta">
      <div class="post_meta_date">
       2018-09-03
      </div>
      <div class="post_commet_cnt">
       <a href="/post/how_to_import_dynamic_css_file_before_rendering/index.html#SOHUCS">
        <span class="cy_cmt_count" id="sourceId::how_to_import_dynamic_css_file_before_rendering">
        </span>
        <span>
         评论
        </span>
       </a>
      </div>
     </div>
     <h1>
      <a href="/post/how_to_import_dynamic_css_file_before_rendering/index.html" title="如何在页面渲染前加入动态的CSS的文件">
       如何在页面渲染前加入动态的CSS的文件
      </a>
     </h1>
     <div class="toc">
      <ul>
       <li>
        <a href="#css">
         页面渲染前加入动态的CSS的文件？
        </a>
       </li>
       <li>
        <a href="#_1">
         排除的方案
        </a>
       </li>
       <li>
        <a href="#_2">
         解决方案
        </a>
       </li>
      </ul>
     </div>
     <h2 id="css">
      页面渲染前加入动态的CSS的文件？
     </h2>
     <p>
      这是我自己的说法，可能不大对。主要描述的是这样的场景：
     </p>
     <ul>
      <li>
       css文件url的前缀可能经常变化（比如换对象存储的提供商、需要做迁移）
      </li>
      <li>
       我们希望在渲染前完成css样式文件的加载
      </li>
     </ul>
     <p>
      所以我的方案场景代码是这样的：
     </p>
     <div class="codehilite">
      <pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">class</span><span class="o">=</span><span class="s">"remoteCss"</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/css"</span> <span class="na">tempHref</span><span class="o">=</span><span class="s">"/css/global.css"</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"main"</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>
     </div>
     <p>
      希望，能够在页面渲染前完成样式文件的引入。css文件url前缀可能为http://baidu.com或者其他。目前我没有搜索到相关的解决方案。
     </p>
     <h2 id="_1">
      排除的方案
     </h2>
     <p>
      有人可能会说，可以直接这样就行了。
     </p>
     <div class="codehilite">
      <pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">class</span><span class="o">=</span><span class="s">"remote_css"</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/css"</span> <span class="na">temp_href</span><span class="o">=</span><span class="s">"/css/global.css"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="kr">const</span> <span class="nx">URL_PREFIX</span><span class="o">=</span><span class="s2">"http://www.baidu.com"</span>
        <span class="nx">css_arr</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">'remote_css'</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">css_arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">css_arr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">href</span><span class="o">=</span><span class="nx">URL_PREFIX</span><span class="o">+</span><span class="nx">css_arr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">"temp_href"</span><span class="p">);</span>
            <span class="cm">/*</span>
<span class="cm">            或者往head动态加入节点，都是不可行的</span>
<span class="cm">            &lt;link class="remote_css" rel="stylesheet" type="text/css" href="http://www.baidu.com/css/global.css"&gt;</span>
<span class="cm">            */</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"main"</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>
     </div>
     <p>
      上面是可以动态加入CSS页面文件，但是不是在页面渲染前加载完成的。也就是会导致刚打开页面时，没有css样式就渲染了，等到样式文件加载完成重新渲染。
     </p>
     <h2 id="_2">
      解决方案
     </h2>
     <p>
      首先，需要把js脚本放在head里面，保证渲染页面前先执行脚本。然后我们需要利用到css的import特性。
     </p>
     <div class="codehilite">
      <pre><span></span><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">class</span><span class="o">=</span><span class="s2">"remote_css"</span> <span class="n">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"text/css"</span> <span class="n">temp_href</span><span class="o">=</span><span class="s2">"/css/global.css"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
        <span class="p">(</span><span class="n">function</span><span class="p">(){</span>
            <span class="n">const</span> <span class="n">URL_PREFIX</span><span class="o">=</span><span class="s2">"http://www.baidu.com"</span><span class="p">;</span>
            <span class="n">let</span> <span class="n">css_arr</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByClassName</span><span class="p">(</span><span class="s2">"remote_css"</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">css_arr</span><span class="o">.</span><span class="n">length</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

            <span class="n">let</span> <span class="n">new_style</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">'style'</span><span class="p">);</span>
            <span class="n">new_style</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"type"</span><span class="p">,</span><span class="s2">"text/css"</span><span class="p">);</span>
            <span class="n">let</span> <span class="n">new_css</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="n">let</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">css_arr</span><span class="o">.</span><span class="n">length</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
                <span class="n">new_css</span><span class="o">=</span><span class="n">new_css</span><span class="o">+</span><span class="s2">"@import url('"</span><span class="o">+</span><span class="n">URL_PREFIX</span><span class="o">+</span><span class="n">css_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">"temp_href"</span><span class="p">)</span><span class="o">+</span><span class="s2">"');</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">new_style</span><span class="o">.</span><span class="n">styleSheet</span><span class="p">){</span>
                <span class="n">new_style</span><span class="o">.</span><span class="n">styleSheet</span><span class="o">.</span><span class="n">cssText</span><span class="o">=</span><span class="n">newCss</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span><span class="p">{</span>
                <span class="n">new_style</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">new_css</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">'head'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">new_style</span><span class="p">);</span>
        <span class="p">})();</span>
    <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"main"</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre>
     </div>
    </article>
    <div class="post_end">
     <br/>
     --END--
     <br/>
     <div class="post_tags">
      标签：
      <a href="/tag.html?tag=前端" title="前端">
       #前端
      </a>
     </div>
    </div>
    <div id="SOHUCS" sid="how_to_import_dynamic_css_file_before_rendering">
    </div>
    <script id="cy_cmt_num" src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cytyIIWkH">
    </script>
   </div>
   <footer>
    Xl的博客 -
    <a href="http://li1996.cn" title="Xl的博客">
     li1996.cn
    </a>
   </footer>
  </div>
  <script src="https://blog-1252791686.cos.ap-beijing.myqcloud.com/js/global.js">
  </script>
  <script src="https://blog-1252791686.cos.ap-beijing.myqcloud.com/js/sohucs.js">
  </script>
 </body>
</html>
